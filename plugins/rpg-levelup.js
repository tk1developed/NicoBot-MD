import {canLevelUp, xpRange} from '../lib/levelling.js';
import {levelup} from '../lib/canvas.js';

const handler = async (m, {conn}) => {
  const name = conn.getName(m.sender);
  const user = global.db.data.users[m.sender];
  if (!canLevelUp(user.level, user.exp, global.multiplier)) {
    const {min, xp, max} = xpRange(user.level, global.multiplier);
    throw `тХн█лргнргнргнргнргнргн┘ЬтФД█л╠╕ргнргнргнргнргн┘ЬтШкя╕Оя╕Оя╕О╠╕тГШргкргкргк█м╠╕ргн┘ЬтЧМтГШ╓ЯсНЭ╓п█к█л█ля╕О█л█мЁРЗ╜тГкЁЯМ╣тЧМтГШргкргкргк█мргн┘ЬтШкя╕Оя╕Оя╕Оя╕О╠╕тФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтХо
тФЬ╠Я╠З╫БтЭНтЬО *ЁЯз╕Nombre:* 
тФЬ╠Я╠З╫БтЭН *${name}*
тФЬ╠Я╠З╫БтФАтФАтФА тЭЦ тФАтФА тЬж тФАтФА тЭЦ тФАтФАтФА
тФЬ╠Я╠З╫БтЭНтЬО *ЁЯУНNivel:* 
тФЬ╠Я╠З╫БтЭН *${user.level}*
тФЬ╠Я╠З╫БтФАтФАтФА тЭЦ тФАтФА тЬж тФАтФА тЭЦ тФАтФАтФА
тФЬ╠Я╠З╫БтЭНтЬО *ЁЯзйExp:*
тФЬ╠Я╠З╫БтЭН *${user.exp - min}/${xp}*
тХ░тФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтШкя╕Оя╕Оя╕О╠╕тГШргкргкргк█м╠╕ргн┘ЬтЧМтГШ╓ЯсНЭ╓п█к█л█ля╕О█л█мЁРЗ╜тГкЁЯМ╕тЧМтГШргкргкргк█мргн┘ЬтШкя╕Оя╕Оя╕Оя╕О╠╕тФД█л╠╕ргнргнргнргнргн┘ЬтХп

*Te Hace Falta ${max - user.exp} De Exp Para Subir De Nivel* ЁЯз╕ЁЯУН
`.trim();
  }
  const before = user.level * 1;
  while (canLevelUp(user.level, user.exp, global.multiplier)) user.level++;
  if (before !== user.level) {
    const teks = `ЁЯОК Bien hecho ${conn.getName(m.sender)}    Nivel:`;
    const str = `тХн█лргнргнргнргнргнргн┘ЬтФД█л╠╕ргнргнргнргнргн┘ЬтШкя╕Оя╕Оя╕О╠╕тГШргкргкргк█м╠╕ргн┘ЬтЧМтГШ╓ЯсНЭ╓п█к█л█ля╕О█л█мЁРЗ╜тГкЁЯМ╗тГШ╓ЯсНЭ╓п█к█л█л█л█мтГктЧМтГШргкргкргк█мргн┘ЬтШкя╕Оя╕Оя╕Оя╕О╠╕тФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтХо
тФЬ╠Я╠З╫БтЭНтЬО *ЁЯз╕Anterior Del Nivel:* 
тФЬ╠Я╠З╫БтЭН *${before}*
тФЬ╠Я╠З╫БтФАтФАтФА тЭЦ тФАтФА тЬж тФАтФА тЭЦ тФАтФАтФА
тФЬ╠Я╠З╫БтЭНтЬО *ЁЯУНNivel Actual:*
тФЬ╠Я╠З╫БтЭН *${user.level}*
тХ░тФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтФД█л╠╕ргнтФД█л╠╕ргнргнргнргнргн┘ЬтФД█л╠╕ргнргнргнргнргн┘ЬтФД█лргнргнргнтШкя╕Оя╕Оя╕О╠╕тГШргкргкргк█м╠╕ргн┘ЬтЧМтГШ╓ЯсНЭ╓п█к█л█ля╕О█л█мЁРЗ╜тГкЁЯНзтГШ╓ЯсНЭ╓п█к█л█л█л█мтГктЧМтГШргкргкргк█мргн┘ЬтШкя╕Оя╕Оя╕Оя╕О╠╕тФД█л╠╕ргнргнргнргнргн┘ЬтХп

Mienstra Mas Uses *SakuraBotLite-MD* Tu Nivel Subir├б Mas RapidoЁЯеАЁЯУН
`.trim();
    try {
      const img = await levelup(teks, user.level);
      conn.sendFile(m.chat, img, 'levelup.jpg', str, m);
    } catch (e) {
      m.reply(str);
    }
  }
};

handler.help = ['levelup'];
handler.tags = ['xp'];

handler.command = ['nivel', 'lvl', 'levelup', 'level'];

export default handler;